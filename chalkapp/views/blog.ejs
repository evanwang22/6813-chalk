<!DOCTYPE html>
<section class="centerUp">
</section>

<div class="overlay" style></div>

<% for (var i = 0; i < posts.length; i++) { %>
<div class="post">
  <% if (posts[i].is_favorite) { %>
    <i class="fa fa-heart favorite" id="<%= posts[i]._id %>"></i>
  <% } else { %>
    <i class="fa fa-heart-o favorite" id="<%= posts[i]._id %>"></i>
  <% } %>
  <a href="#" class="dropdown-icon"><i class="fa fa-chevron-down">
  <ul class="dropdown">
      <li class="modalLink" href="<%= '#modalEdit' + posts[i]._id %>">Edit</li>
      <li>Delete</li>
  </ul>
  </i></a>

  <div id="<%= 'modalEdit' + posts[i]._id %>" class="modal">
  <p class="closeBtn">x</p>
  <h2>Edit Post</h2>
  <form method="post" action="blog/edit_post" enctype="multipart/form-data" class="dropzone form-wrapper-01" id="photo-dropzone">
      <input class="inputbox title" type="text" value="<%= posts[i].title %>" name="title" />
      <input class="inputbox content" type="content" value="<%= posts[i].body %>" name="body">
      <input class="inputbox tagEntry" type="text" value="<%= posts[i].tags %>" name="tagsEntered" />
      <div class="inputbox fallback">
        <input type="file" name="image" />
      </div>
    </form>
    <button id="update-button" class"turquoise-flat-button2">Update</button>
  </div>


  <span class="date"><%= posts[i].time %></span>
  <span class="title"><%= posts[i].title %></span>
  <% if (posts[i].image) {%>
      <img class="photo" src= "<%=/images/ + posts[i].image %>" alt="Paper Flower Crafts">
  <% } %>
  <%= posts[i].body %>
  <ul class="tags">
    <% if (posts[i].tags) { %>
      <% for (var j = 0; j < posts[i].tags.length; j++) { %>
       <li><a href="/tags/<%=posts[i].tags[j]%>"><%= posts[i].tags[j] %></a></li>
      <% } %>
    <% } %>
  </ul>
</div>
<% } %>

<script>
  $(function() {

    var imageAdded = false;
    var photoDZ;
    $('.modalLink').click(function () {
      photoDZ = Dropzone.instances[0];
      photoDZ.on("addedfile", function(){ imageAdded = true });
    });

    $('#publish-button').click(function () {
      if (imageAdded) {
        photoDZ.processQueue();
        setTimeout(function() {location.reload(true)}, 1000);
      } else {
        $('#photo-dropzone').submit();
      }
    });
  });
    
    $(".favorite").click(function() {
      var is_fav;
      if ($(this).hasClass('fa-heart-o')){
        is_fav = true;
        $(this).removeClass('fa-heart-o');
        $(this).addClass('fa-heart');
      }
      else{
        is_fav = false;
        $(this).removeClass('fa-heart');
        $(this).addClass('fa-heart-o');
      }

      var data = {}
      data.id = $(this).attr('id');
      data.is_fav = is_fav;

      $.ajax({
        type:'POST',
        data: JSON.stringify(data),
        contentType:'application/json',
        url:'/blog/favorite',
        success: function(data){
          console.log('success');
          console.log(JSON.stringify(data));
        }
      });
    });
</script>
